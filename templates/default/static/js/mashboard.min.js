jQuery(window).ready(function(t){"use strict";var s=t("#skystats-cards-loading-container");t.get(ajaxurl,{action:"skystats_ajax_licensing_api_query",query:"check_license"},function(a){if(a=t.parseJSON(a),"error"===a.responseType){var e=t("#skystats-page-error-container"),n=e.find("p");switch(a.responseContext){case"missing_license_key":n.html(skystats_mashboard.trans.licensing.missing_license_key);break;case"license_expired":n.html(skystats_mashboard.trans.licensing.license_expired);break;case"malformed_license_key":n.html(skystats_mashboard.trans.licensing.malformed_license_key);break;case"http_error":n.html(skystats_mashboard.trans.licensing.http_error);break;case"error_initialising_request":n.html(skystats_mashboard.trans.licensing.error_initializing_request);break;case"error_executing_request":n.html(skystats_mashboard.trans.licensing.error_executing_request);break;case"malformed_response":n.html(skystats_mashboard.trans.licensing.malformed_request);break;case"license_site_inactive":n.html(skystats_mashboard.trans.licensing.license_site_inactive);break;case"license_site_inactive_no_activations_left":n.html(skystats_mashboard.trans.licensing.license_site_inactive_no_activations_left);break;case"license_inactive":n.html(skystats_mashboard.trans.licensing.license_inactive);break;case"license_inactive_no_activations_left":n.html(skystats_mashboard.trans.licensing.license_inactive_no_activations_left);break;case"license_disabled":n.html(skystats_mashboard.trans.licensing.license_disabled);break;case"license_unknown_status":default:n.html(skystats_mashboard.trans.licensing.license_unknown_status)}s.fadeOut(400,function(){e.fadeIn()})}else t.get(ajaxurl,{action:"skystats_ajax_get_mashboard_card_positions"},function(a){a=t.parseJSON(a),t.each(a,function(s,a){var e="#"+s;t.each(a,function(s,a){t("#"+a).appendTo(e)})}),s.fadeOut(400,function(){var s={dateFormat:"mm/dd/yy",changeMonth:!0,changeYear:!0,minDate:-30,maxDate:"today",onSelect:function(s,a){s!==a.lastVal&&t(this).change()}},a=t("#start_date"),e=t("#end_date"),n=new Date,r=24*60*60*1e3*30;n.setTime(n.getTime()-r);var i=n.toDateString();a.change(function(){var s=new Date(t(this).val()).toDateString(),a=new Date(e.val()).toDateString();s===i&&a===(new Date).toDateString()&&e.datepicker("setDate","-1")}),e.change(function(){var s=new Date(t(this).val()).toDateString(),e=(new Date).toDateString(),n=new Date(a.val()).toDateString();s===e&&i===n&&a.datepicker("setDate","-29d")}),a.datepicker(s),e.datepicker(s),a.datepicker("setDate","-30d"),e.datepicker("setDate","-1d"),t("#skystats-date-range-container").fadeIn(),t("#skystats-date-range-notice-container").fadeIn(),t(".skystats-card").fadeIn();var o=t(".skystats-mashboard-vote-now");o.addClass("skystats-disabled"),t.get(ajaxurl,{action:"skystats_ajax_get_integration_vote_totals"},function(s){s=t.parseJSON(s),null!=s.result&&t.each(s.result,function(s,a){var e="#skystats-"+s+"-integration-vote-totals-container",n=t(e),r=n.find(">strong"),i=n.find(">span");r.text(a),i.text(1===parseInt(a)?skystats_mashboard.trans.integration_vote:skystats_mashboard.trans.integration_votes)}),t(".skystats-integration-vote-totals-loading-container").fadeOut(400,function(){t(".skystats-integration-vote-totals-container").fadeIn(),o.removeClass("skystats-disabled")})}),o.off("click"),o.on("click",function(s){s.preventDefault();var a=t(this);if(!a.hasClass("skystats-disabled")){var e=a.prev(),n=e.find(">strong"),r=e.find(">span"),i=t(".skystats-loading-container").first().clone();i.attr("id",""),i.addClass("skystats-integration-vote-loading-container"),i.insertBefore(a),i.show(),a.hide();var o=a.attr("data-integration");if(t("#skystats-mashboard-"+o+"-vote-result-message").remove().end(),t("#skystats-mashboard-"+o+"-vote-result-sub-message").remove(),"true"!==skystats_mashboard.voting_opted_in){var c=t('<p id="skystats-mashboard-'+o+'-vote-result-message" class="skystats-mashboard-vote-result-message">'+skystats_mashboard.trans.voting_not_opted_in_message+"</p>"+'<p id="skystats-mashboard-'+o+'-vote-result-sub-message" class="skystats-mashboard-vote-result-sub-message">'+skystats_mashboard.trans.voting_not_opted_in_sub_message+"</p>");return c.insertBefore(a),a.parent().children().first().remove(),a.remove(),void i.remove()}var c=t('<p id="skystats-mashboard-'+o+'-vote-result-message" class="skystats-mashboard-vote-result-message">'+skystats_mashboard.trans.integration_vote_result_message+"</p>"+'<p id="skystats-mashboard-'+o+'-vote-result-sub-message" class="skystats-mashboard-vote-result-sub-message">'+skystats_mashboard.trans.integration_vote_result_sub_message+"</p>");t.post(ajaxurl,{action:"skystats_ajax_vote_for_integration",integration:o},function(){var t=parseInt(n.text())+1;n.text(t),r.text(t>1?skystats_mashboard.trans.integration_votes:skystats_mashboard.trans.integration_vote),c.insertBefore(a),a.parent().children().first().remove(),a.remove(),i.remove()})}}),initTooltips();var c=getIntegrations("mashboard"),_=c.length;makeCardsSortable(c,_),t("#date_range").click(function(){for(var t=!1,s=0;_>s;++s)c[s].updateDataTabData(t),t=!0}),t(window).resize(function(){for(var t=0;_>t;++t)c[t].resizeChart()});for(var l=0;_>l;++l)c[l].loadDataTabData()})})})});