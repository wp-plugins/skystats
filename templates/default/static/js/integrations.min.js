function createObject(t){function a(){}return a.prototype=t,new a}function Integration(t){this.viewName=t,this.startDate=$("#start_date").val(),this.endDate=$("#end_date").val(),this.chartOptions={grid:{backgroundColor:null,borderColor:{top:"#c8c8c8",left:"#c8c8c8",right:"#c8c8c8",bottom:"#c8c8c8"},borderWidth:1,hoverable:!0},legend:{show:!1},series:{lines:{show:!0},points:{fillColor:null,fill:1,radius:3.5,show:!0}},shadowSize:0,tooltip:!0,tooltipOpts:{content:function(t,a,e){return e.toString()}},xaxis:{mode:"categories"}},"detail"===this.viewName&&(this.$chartFigure=$("#skystats-detail-chart-key-container"))}function GoogleAnalytics(t){Integration.call(this,t),this.integrationName="Google Analytics",this.translations="mashboard"===this.viewName?skystats_mashboard.trans:skystats_google_analytics.trans,this.selectedProfileID="mashboard"===this.viewName?skystats_mashboard.google_analytics.selected_profile_id:skystats_google_analytics.selected_profile_id,this.data=null,this.$loadingContainer=$("#skystats-google-analytics-loading-container"),this.$dataPointsContainer=$("#skystats-google-analytics-data-points-container"),this.$dataTableColumnsContent=$(".skystats-data-table-column-content"),this.loadingDataTabData=!1,this.viewingDataTab=!1,this.loadedAllData=!1,this.topKeywordsData=null,this.topSearchEngineReferralsData=null,this.topLandingPagesData=null,this.topVisitorLocationsData=null,this.chartID="skystats-google-analytics-chart",this.$chart=$("#"+this.chartID),this.$chartContainer=$("#skystats-google-analytics-chart-container"),this.chartInstance=null,this.frequency="daily",this.chartData=[{color:"#FFC951",data:[],label:""},{color:"#FF956C",data:[],label:""}],this.gridIconSelector="#skystats-google-analytics-grid-icon",this.$gridIcon=$(this.gridIconSelector),this.gridIconContentSelector="#skystats-google-analytics-grid-icon-content",this.gridIconChildrenContent=$("#skystats-google-analytics-grid-icon-content").html(),this.gridDisplayed=!1,this.gridClickEventName="click.ga_grid",this.gridMouseoverEventName="mouseover.ga_grid",this.gridMouseleaveEventName="mouseleave.ga_grid",this.gridMouseoutEventName="mouseout.ga_grid",this.$settingsIcon=$("#skystats-google-analytics-settings-icon"),this.loadingSettingsTabData=!1,this.viewingSettingsTab=!1,this.$settingsTabSections=$(".skystats-google-analytics-settings-tab-section"),this.$settingsTabSetupSection=$("#skystats-google-analytics-settings-setup-section"),this.$settingsTabReauthorizeSection=$("#skystats-google-analytics-settings-reauthorize-section"),this.$settingsTabDeauthorizeSection=$("#skystats-google-analytics-settings-deauthorize-section"),this.$settingsTabNoProfilesSection=$("#skystats-google-analytics-settings-no-profiles-section"),this.$settingsTabProfilesSection=$("#skystats-google-analytics-settings-profiles-section"),this.settingsClickEventName="click.ga_settings"}function Facebook(t){Integration.call(this,t),this.integrationName="Facebook",this.$loadingContainer=$("#skystats-facebook-loading-container"),this.translations="mashboard"===this.viewName?skystats_mashboard.trans:skystats_facebook.trans,this.selectedPageID="mashboard"===this.viewName?skystats_mashboard.facebook.selected_page_id:skystats_facebook.selected_page_id,this.data=null,this.loadingDataTabData=!1,this.viewingDataTab=!1,this.loadedAllData=!1,this.topPostsData=null,this.$dataTableColumnsContent=$(".skystats-data-table-column-content"),this.$dataTabContent=$("#skystats-facebook-data-tab-content"),this.$dataPointsContainer=$("#skystats-facebook-data-points-container"),this.chartInstance=null,this.chartID="skystats-facebook-chart",this.$chart=$("#"+this.chartID),this.$chartContainer=$("#skystats-facebook-chart-container"),this.chartData=[{color:"#66ccff",data:[],label:""},{color:"#35d1ae",data:[],label:""}],this.gridIconSelector="#skystats-facebook-grid-icon",this.$gridIcon=$(this.gridIconSelector),this.gridIconContentSelector="#skystats-facebook-grid-icon-content",this.gridIconChildrenContent=$("#skystats-facebook-grid-icon-content").html(),this.gridDisplayed=!1,this.gridClickEventName="click.fb_grid",this.gridMouseoverEventName="mouseover.fb_grid",this.gridMouseleaveEventName="mouseleave.fb_grid",this.gridMouseoutEventName="mouseout.fb_grid",this.loadingSettingsTabData=!1,this.viewingSettingsTab=!1,this.$settingsIcon=$("#skystats-facebook-settings-icon"),this.$settingsTabSections=$(".skystats-facebook-settings-tab-section"),this.$settingsTabNoPagesSection=$("#skystats-facebook-settings-no-pages-section"),this.$settingsTabPageSelectionSection=$("#skystats-facebook-settings-page-selection-section"),this.$settingsTabReauthorizeSection=$("#skystats-facebook-settings-reauthorize-section"),this.$settingsTabDeauthorizeSection=$("#skystats-facebook-settings-deauthorize-section"),this.$settingsTabAuthorizeSection=$("#skystats-facebook-settings-authorize-section"),this.settingsClickEventName="click.fb_settings"}function getIntegration(t,a){switch(t){case"googleAnalytics":return new GoogleAnalytics(a);case"facebook":return new Facebook(a)}}function getIntegrations(t){var a=new GoogleAnalytics(t),e=new Facebook(t);return[a,e]}function initTooltips(){$(".skystats-tooltip").each(function(){var t=$(this);return t.hasClass("skystats-disabled")?!0:void t.tooltip({content:t.attr("data-tooltip"),items:"[data-tooltip]"})})}function makeCardsSortable(t,a){var e=".skystats-cards-col",s=$(e);s.sortable({connectWith:e,cursor:"move",forcePlaceholderSize:!0,handle:".skystats-card-drag-icon",placeholder:"skystats-card-placeholder",revert:400,stop:function(){var e={};s.each(function(t,a){var s=$(a).attr("id");e[s]=$(a).sortable("toArray")});for(var i=0;a>i;++i)t[i].resizeChart();$.post(ajaxurl,{action:"skystats_ajax_save_mashboard_card_positions",data:e})}}),s.disableSelection()}$=jQuery,Integration.prototype.showChartFigure=function(){"detail"===this.viewName&&this.$chartFigure.show()},Integration.prototype.hideChartFigure=function(){"detail"===this.viewName&&this.$chartFigure.hide()},Integration.prototype.updateDataTabData=function(t){var a=$("#skystats-page-error-container");if(t||a.fadeOut(),"Facebook"===this.integrationName){var e=$("#skystats-facebook-error-container");e.fadeOut()}else if("Google Analytics"===this.integrationName){var s=$("#skystats-google-analytics-error-container");s.fadeOut()}if(this.startDate=$("#start_date").val(),this.endDate=$("#end_date").val(),"Google Analytics"===this.integrationName&&"detail"===this.viewName&&(this.frequency=$("#frequency").val()),!this.viewingSettingsTab&&!this.loadingSettingsTabData){var i=new Date(this.startDate),o=i.getTime()/1e3,n=new Date(this.endDate),r=n.getTime()/1e3,c=24*60*60*1e3*31,l=new Date,d=(n-i)/1e3+86400,g=d/60/60/24,h=a.find("> p"),p=!1;l.setTime(l.getTime()-c);var u=l.getTime()/1e3;if(1>=g?(h.html(this.translations.date_range_same),p=!0):d>Date.now()?(h.html(this.translations.date_range_exceeds_today),p=!0):(u>o||u>r)&&("detail"===this.viewName?(h.html(this.translations.date_range_below_min),a.fadeIn()):"Facebook"===this.integrationName?(e.find("> p").html(this.translations.date_range_below_min),e.fadeIn()):"Google Analytics"===this.integrationName&&(s.find("> p").html(this.translations.date_range_below_min),s.fadeIn())),p)return void(t||a.fadeIn());this.data=null,"detail"===this.viewName&&(this.loadedAllData=!1),setGlobalPossibleMarkers(null),this.disableGridIcon(),this.disableSettingsIcon(),this.hideChartFigure(),this.loadDataTabData()}},Integration.prototype.resizeChart=function(){},Integration.prototype.reinitGridChildrenContent=function(){this.gridIconChildrenContent=$(this.gridIconContentSelector).html()},Integration.prototype.enableGridIcon=function(){this.$gridIcon.removeClass("skystats-disabled"),this.$gridIcon.tooltip({content:this.$gridIcon.attr("data-tooltip"),items:"[data-tooltip]"});var t=this;this.$gridIcon.on(this.gridClickEventName,function(){var a="";if(!0===t.gridDisplayed)a=t.$gridIcon.attr("data-tooltip"),t.$gridIcon.tooltip("option","content",a),t.gridDisplayed=!1;else{t.$gridIcon.removeClass("skystats-tooltip"),t.gridDisplayed=!0;var e=$(t.gridIconContentSelector).find("input");e.each(function(t,a){var e=$(a);$("#"+e.val()).is(":visible")?e.attr("checked",!0):e.attr("checked",!1)}),t.reinitGridChildrenContent(),a=t.gridIconChildrenContent,t.$gridIcon.tooltip("destroy"),t.$gridIcon.tooltip({content:a,items:t.gridIconSelector}),t.$gridIcon.tooltip("open"),$(".skystats-show-data-point").change(function(){var t=$(this);this.checked?($("#"+t.val()).show(),t.attr("checked",!0)):($("#"+t.val()).hide(),t.attr("checked",!1))})}}),this.$gridIcon.on(this.gridMouseoverEventName+" "+this.gridMouseleaveEventName+" "+this.gridMouseoutEventName,function(a){!0===t.gridDisplayed&&a.stopImmediatePropagation()})},Integration.prototype.disableGridIcon=function(){this.$gridIcon.addClass("skystats-disabled");var t=this.$gridIcon.tooltip("instance");null!=t&&t.destroy(),this.$gridIcon.off(this.gridClickEventName+" "+this.gridMouseoverEventName+" "+this.gridMouseleaveEventName+" "+this.gridMouseoutEventName),this.gridDisplayed=!1},Integration.prototype.enableSettingsIcon=function(){var t=this;this.$settingsIcon.removeClass("skystats-disabled"),this.$settingsIcon.tooltip({content:this.$settingsIcon.attr("data-tooltip"),items:"[data-tooltip]"}),this.$settingsIcon.on(this.settingsClickEventName,function(){if(!0===t.viewingSettingsTab){if(!0===t.loadingDataTabData)return;t.viewingSettingsTab=!1,t.loadingDataTabData=!0,t.disableSettingsIcon(),t.loadDataTabData()}else if(!0===t.viewingDataTab){if(!0===t.loadingSettingsTabData)return;t.viewingDataTab=!1,t.loadingSettingsTabData=!0,t.disableGridIcon(),t.disableSettingsIcon(),t.loadSettingsTabData("cached")}})},Integration.prototype.disableSettingsIcon=function(){this.$settingsIcon.addClass("skystats-disabled");var t=this.$settingsIcon.tooltip("instance");null!=t&&t.destroy(),this.$settingsIcon.off(this.settingsClickEventName)},Integration.prototype.changeTooltipContent=function(t,a){var e=null;e=t instanceof jQuery?t.tooltip("instance"):$(t).tooltip("instance"),null!=e&&e.option("content",a)},GoogleAnalytics.prototype=createObject(Integration.prototype),GoogleAnalytics.prototype.constructor=GoogleAnalytics,GoogleAnalytics.prototype.resizeChart=function(){null!=this.data&&(setGlobalPossibleMarkers(null),this.chartInstance.shutdown(),this.chartData[0].data=getChartData(this.data.chart_data.users,this.$chart,this,this.frequency),this.chartData[1].data=getChartData(this.data.chart_data.page_views,this.$chart,this,this.frequency),this.chartInstance=this.$chart.plot(this.chartData,this.chartOptions).data("plot"))},GoogleAnalytics.prototype.loadDataTabData=function(){var t=$("#frequency");t.length&&(this.frequency=t.val()),this.viewingSettingsTab=!1,this.loadingDataTabData=!0;var a=this;this.$settingsTabSections.add(this.$chartContainer).add(this.$dataPointsContainer).add(this.$dataTableColumnsContent).fadeOut(400).promise().done(function(){a.$loadingContainer.fadeIn(400,function(){if("mashboard"===a.viewName){if(a.data)return void a.displayDataTabData();$.get(ajaxurl,{action:"skystats_ajax_google_analytics_api_query",query:"get_mashboard_view_data",start_date:a.startDate,end_date:a.endDate},function(t){t=$.parseJSON(t),"success"===t.responseType?(a.data=t.data,a.displayDataTabData(t)):a.loadSettingsTabData("fresh")})}else if("detail"===a.viewName)if(a.loadedAllData)a.displayDataTabData();else{var t=a.getDetailViewDataDeferredObject(),e=a.getTopKeywordsDeferredObject(),s=a.getTopSearchEngineReferralsDeferredObject(),i=a.getTopLandingPagesDeferredObject(),o=a.getTopVisitorLocationsDeferredObject();$.when(t,e,s,i,o).done(function(t,e,s,i,o){var n=$.parseJSON(t[0]);"error"===n.responseType?a.loadSettingsTabData("fresh"):(a.loadedAllData=!0,a.data=$.parseJSON(t[0]).data,a.topKeywordsData=$.parseJSON(e[0]).data,a.topSearchEngineReferralsData=$.parseJSON(s[0]).data,a.topLandingPagesData=$.parseJSON(i[0]).data,a.topVisitorLocationsData=$.parseJSON(o[0]).data,a.displayDataTabData())})}})})},GoogleAnalytics.prototype.getDetailViewDataDeferredObject=function(){return $.get(ajaxurl,{action:"skystats_ajax_google_analytics_api_query",query:"get_detail_view_data",start_date:this.startDate,end_date:this.endDate,frequency:this.frequency})},GoogleAnalytics.prototype.getTopKeywordsDeferredObject=function(){return $.get(ajaxurl,{action:"skystats_ajax_get_google_analytics_top_data",data_type:"keywords",start_date:this.startDate,end_date:this.endDate})},GoogleAnalytics.prototype.getTopSearchEngineReferralsDeferredObject=function(){return $.get(ajaxurl,{action:"skystats_ajax_get_google_analytics_top_data",data_type:"search_engine_referrals",start_date:this.startDate,end_date:this.endDate})},GoogleAnalytics.prototype.getTopLandingPagesDeferredObject=function(){return $.get(ajaxurl,{action:"skystats_ajax_get_google_analytics_top_data",data_type:"landing_pages",start_date:this.startDate,end_date:this.endDate})},GoogleAnalytics.prototype.getTopVisitorLocationsDeferredObject=function(){return $.get(ajaxurl,{action:"skystats_ajax_get_google_analytics_top_data",data_type:"visitor_locations",start_date:this.startDate,end_date:this.endDate})},GoogleAnalytics.prototype.displayDataTabData=function(){var t=this;this.$loadingContainer.fadeOut(400,function(){t.showChartFigure(),t.$chartContainer.show(),t.$dataPointsContainer.show(),null!==t.chartInstance&&t.chartInstance.shutdown(),t.chartData[0].data=getChartData(t.data.chart_data.users,t.$chart,t,t.frequency),t.chartData[1].data=getChartData(t.data.chart_data.page_views,t.$chart,t,t.frequency),t.chartInstance=t.$chart.plot(t.chartData,t.chartOptions).data("plot"),$("#skystats-google-analytics-users-total").html(t.data.users),$("#skystats-google-analytics-users-change").html(t.data.users_change);var a=$("#skystats-google-analytics-users-change-info");t.changeTooltipContent(a,t.data.previous_users+" "+a.attr("data-tooltip-backup")),setDataPointChangeDirectionClass("skystats-google-analytics-users-change-direction",t.data.users_change_direction),setDataPointChangeClass("skystats-google-analytics-users-change",t.data.users_change_direction),$("#skystats-google-analytics-page-views-total").html(t.data.page_views),$("#skystats-google-analytics-page-views-change").html(t.data.page_views_change);var e=$("#skystats-google-analytics-page-views-change-info");if(t.changeTooltipContent(e,t.data.previous_page_views+" "+e.attr("data-tooltip-backup")),setDataPointChangeDirectionClass("skystats-google-analytics-page-views-change-direction",t.data.page_views_change_direction),setDataPointChangeClass("skystats-google-analytics-page-views-change",t.data.page_views_change_direction),"mashboard"===t.viewName){var s=$("#skystats-google-analytics-bounce-rate");s.html("");var i=$("#skystats-google-analytics-bounce-rate-data-point"),o=!1;i.is(":visible")||(o=!0,i.show());var n=Morris.Donut({data:[{label:t.data.bounce_rate+"%",value:t.data.bounce_rate},{label:t.data.bounce_rate_change+"%",value:100-t.data.bounce_rate}],element:"skystats-google-analytics-bounce-rate",colors:["#72aa3f","#ffffff"],resize:!1,formatter:function(){return"negative"===t.data.bounce_rate_change_direction?"▽"+t.data.bounce_rate_change:"positive"===t.data.bounce_rate_change_direction?"Δ+"+t.data.bounce_rate_change:t.data.bounce_rate_change}});n.select(0);var r=s.find("svg"),c=r.children();c.eq(2).css("stroke","none").end().eq(3).css("stroke","none").end().eq(4).css("stroke","none").end().eq(5).css("stroke","none").css("fill","#eeeeee");var l=c.eq(6);l.html("<tspan>"+t.data.bounce_rate+'</tspan><tspan dy="-7" dx="0" style="font-size:16px;">%</tspan>'),l.attr("class","skystats-donut-value"),l.attr("font-size","25px"),l.attr("y","70"),r.css("left","-10%");var d=c.eq(7).find("tspan");switch(t.data.bounce_rate_change_direction){case"positive":d.attr("class","skystats-data-point-change skystats-data-point-change-negative");break;case"negative":d.attr("class","skystats-data-point-change skystats-data-point-change-positive");break;default:d.attr("class","skystats-data-point-change")}setDataPointChangeDirectionClass("skystats-google-analytics-bounce-rate-change-direction",t.data.bounce_rate_change_direction),d.attr("fill",d.css("color")).css("font-size","19px").attr("dy","6");var g=$('<tspan dy="-4" dx="2" fill="'+d.css("color")+'" style="font-size: 12px;">%</tspan>');g.appendTo(d),s.html(s.html()),d=null,o&&i.is(":visible")&&i.hide()}if("detail"===t.viewName){$("#skystats-google-analytics-pages-per-visit-total").html(t.data.pages_per_visit),$("#skystats-google-analytics-pages-per-visit-change").html(t.data.pages_per_visit_change);var h=$("#skystats-google-analytics-pages-per-visit-change-info");t.changeTooltipContent(h,t.data.previous_pages_per_visit+" "+h.attr("data-tooltip-backup")),setDataPointChangeDirectionClass("skystats-google-analytics-pages-per-visit-change-direction",t.data.pages_per_visit_change_direction),setDataPointChangeClass("skystats-google-analytics-pages-per-visit-change",t.data.pages_per_visit_change_direction),$("#skystats-google-analytics-average-visit-duration-total").html(t.data.average_visit_duration),$("#skystats-google-analytics-average-visit-duration-change").html(t.data.average_visit_duration_change);var p=$("#skystats-google-analytics-average-visit-duration-change-info");t.changeTooltipContent(p,t.data.previous_average_visit_duration+" "+p.attr("data-tooltip-backup")),setDataPointChangeDirectionClass("skystats-google-analytics-average-visit-duration-change-direction",t.data.average_visit_duration_change_direction),setDataPointChangeClass("skystats-google-analytics-average-visit-duration-change",t.data.average_visit_duration_change_direction);var u=$("#skystats-google-analytics-bounce-rate-total");u.html(t.data.bounce_rate),d=$("#skystats-google-analytics-bounce-rate-change"),d.html(t.data.bounce_rate_change);var y=$("#skystats-google-analytics-bounce-rate-change-info");t.changeTooltipContent(y,t.data.previous_bounce_rate+" "+y.attr("data-tooltip-backup"));if("neutral"===t.data.bounce_rate_change_direction)setDataPointChangeDirectionClass("skystats-google-analytics-bounce-rate-change-direction","neutral"),setDataPointChangeClass("skystats-google-analytics-bounce-rate-change","neutral");else{var f=$("#skystats-google-analytics-bounce-rate-change-direction");"positive"===t.data.bounce_rate_change_direction?(d.attr("class","skystats-data-point-change skystats-data-point-change-increase-negative"),f.attr("class","skystats-data-point-change-direction-increase-negative")):"negative"===t.data.bounce_rate_change_direction&&(d.attr("class","skystats-data-point-change skystats-data-point-change-decrease-positive"),f.attr("class","skystats-data-point-change-direction-decrease-positive"))}if(null!=t.topKeywordsData){var b=$("#skystats-google-analytics-top-keywords-data-table"),_=b.find("> tbody");_.html("");var k="";$.each(t.topKeywordsData,function(t,a){k+="<tr><td>"+a.keyword+"</td><td>"+a.visits+"</td><td>"+a.percent+"</td></tr>"}),$(k).appendTo(_),$("#skystats-detail-google-analytics-top-keywords-data-table-column-content").fadeIn()}if(null!=t.topSearchEngineReferralsData){var v=$("#skystats-google-analytics-top-search-engine-referrals-data-table"),D=v.find("> tbody");D.html("");var m="";$.each(t.topSearchEngineReferralsData,function(t,a){m+="<tr><td>"+a.search_engine+"</td><td>"+a.visits+"</td><td>"+a.percent+"</td></tr>"}),$(m).appendTo(D),$("#skystats-detail-google-analytics-top-search-engine-referrals-data-table-column-content").fadeIn()}if(null!=t.topLandingPagesData){var C=$("#skystats-google-analytics-top-landing-pages-data-table"),I=C.find("> tbody");I.html("");var T="";$.each(t.topLandingPagesData,function(t,a){T+="<tr><td>"+a.page+"</td><td>"+a.visits+"</td><td>"+a.percent+"</td></tr>"}),$(T).appendTo(I),$("#skystats-detail-google-analytics-top-landing-pages-data-table-column-content").fadeIn()}if(null!=t.topVisitorLocationsData){var S=$("#skystats-google-analytics-visitor-locations-data-table"),w=S.find("> tbody");w.html("");var N="";$.each(t.topVisitorLocationsData,function(t,a){N+="<tr><td>"+a.country+"</td><td>"+a.visits+"</td><td>"+a.percent+"</td></tr>"}),$(N).appendTo(w),$("#skystats-detail-google-analytics-top-visitor-locations-data-table-column-content").fadeIn()}}$("#skystats-google-analytics-search-engine-visits-total").html(t.data.search_engine_visits),$("#skystats-google-analytics-search-engine-visits-change").html(t.data.search_engine_visits_change);var P=$("#skystats-google-analytics-search-engine-visits-change-info");t.changeTooltipContent(P,t.data.previous_search_engine_visits+" "+P.attr("data-tooltip-backup")),setDataPointChangeDirectionClass("skystats-google-analytics-search-engine-visits-change-direction",t.data.search_engine_visits_change_direction),setDataPointChangeClass("skystats-google-analytics-search-engine-visits-change",t.data.search_engine_visits_change_direction),t.enableGridIcon(),t.enableSettingsIcon(),t.loadingDataTabData=!1,t.viewingDataTab=!0})},GoogleAnalytics.prototype.enableGridIcon=function(){Integration.prototype.enableGridIcon.call(this)},GoogleAnalytics.prototype.disableGridIcon=function(){Integration.prototype.disableGridIcon.call(this)},GoogleAnalytics.prototype.enableSettingsIcon=function(){Integration.prototype.enableSettingsIcon.call(this)},GoogleAnalytics.prototype.disableSettingsIcon=function(){Integration.prototype.disableSettingsIcon.call(this)},GoogleAnalytics.prototype.loadSettingsTabData=function(t){this.hideChartFigure();var a=this,e="mashboard"===this.viewName?this.$dataPointsContainer.add(this.$chartContainer):this.$dataPointsContainer.add(this.$chartContainer).add(this.$dataTableColumnsContent);e.fadeOut(400).promise().done(function(){a.$loadingContainer.fadeIn(400,function(){$.get(ajaxurl,{action:"skystats_ajax_google_analytics_api_query",query:"get_profiles",request_type:t},function(t){t=$.parseJSON(t),a.displaySettingsTabData(t)})})})},GoogleAnalytics.prototype.displaySettingsTabData=function(t){var a=this;a.$loadingContainer.fadeOut(400,function(){if("success"===t.responseType){var e="",s=$("#ga-profiles");$.each(t.data,function(t,s){var i=a.selectedProfileID===s.id?'selected="selected"':"";e+='<option value="'+s.id+'" '+i+">"+s.name+"</option>"}),s.html(e),a.$settingsTabProfilesSection.fadeIn();var i=$("#save_ga_profile");i.off("click"),i.one("click",function(t){t.preventDefault(),a.disableSettingsIcon();var e=s.val();a.selectedProfileID=e,a.$settingsTabSections.fadeOut(400).promise().done(function(){a.$loadingContainer.fadeIn(400,function(){$.post(ajaxurl,{action:"skystats_ajax_google_analytics_save_profile_id",profile_id:e},function(){a.data=null,"detail"===a.viewName&&(a.loadedAllData=!1),a.loadDataTabData()})})})}),a.$settingsTabDeauthorizeSection.fadeIn()}else switch(t.responseContext){case"authorization_required":a.$settingsTabSetupSection.fadeIn();break;case"reauthorization_required":a.$settingsTabReauthorizeSection.fadeIn();break;case"no_profiles":a.$settingsTabNoProfilesSection.fadeIn(),a.$settingsTabDeauthorizeSection.fadeIn();break;default:a.$settingsTabDeauthorizeSection.fadeIn()}if(a.viewingSettingsTab=!0,a.loadingSettingsTabData=!1,null!=a.data&&a.enableSettingsIcon(),a.$settingsTabSetupSection.is(":visible")||a.$settingsTabReauthorizeSection.is(":visible")){var o=$("#skystats-google-analytics-authorize, #skystats-google-analytics-reauthorize");o.off("click").on("click",function(){a.$settingsTabSections.fadeOut(400).promise().done(function(){a.$loadingContainer.fadeIn(400,function(){$.post(ajaxurl,{action:"skystats_ajax_google_analytics_authorize"})})})})}if(a.$settingsTabDeauthorizeSection.is(":visible")){var n=$("#skystats-google-analytics-deauthorize");n.off("click"),n.one("click",function(){a.$settingsTabSections.fadeOut(400).promise().done(function(){a.$loadingContainer.fadeIn(400,function(){$.post(ajaxurl,{action:"skystats_ajax_google_analytics_deauthorize"})})})})}})},GoogleAnalytics.prototype.updateDataTabData=function(t){Integration.prototype.updateDataTabData.call(this,t)},Facebook.prototype=createObject(Integration.prototype),Facebook.prototype.constructor=Facebook,Facebook.prototype.loadDataTabData=function(){this.hideChartFigure(),this.viewingSettingsTab=!1,this.loadingDataTabData=!0;var t=this;this.$settingsTabSections.add(this.$chartContainer).add(this.$dataPointsContainer).add(this.$dataTableColumnsContent).fadeOut(400).promise().done(function(){t.$loadingContainer.fadeIn(400,function(){if("mashboard"===t.viewName){if(null!=t.data)return void t.displayDataTabData();$.get(ajaxurl,{action:"skystats_ajax_facebook_get_mashboard_view_data",start_date:t.startDate,end_date:t.endDate},function(a){a=$.parseJSON(a),null!=a.data?(t.data=a.data,t.displayDataTabData()):t.loadSettingsTabData("fresh")})}else if("detail"===t.viewName)if(!0===t.loadedAllData)t.displayDataTabData();else{var a=t.getDetailViewDataDeferredObject(),e=t.getTopPostsDeferredObject();$.when(a,e).done(function(a,e){var s=$.parseJSON(a[0]);"error"===s.responseType?t.loadSettingsTabData("fresh"):(t.loadedAllData=!0,t.data=$.parseJSON(a[0]).data,t.topPostsData=$.parseJSON(e[0]).data,t.displayDataTabData())})}})})},Facebook.prototype.getDetailViewDataDeferredObject=function(){return $.get(ajaxurl,{action:"skystats_ajax_facebook_get_detail_view_data",start_date:this.startDate,end_date:this.endDate})},Facebook.prototype.getTopPostsDeferredObject=function(){return $.get(ajaxurl,{action:"skystats_ajax_facebook_get_page_top_posts",start_date:this.startDate,end_date:this.endDate})},Facebook.prototype.displayDataTabData=function(){var t=this;this.$loadingContainer.fadeOut(400,function(){t.showChartFigure(),t.$dataTabContent.fadeIn(),t.$chartContainer.show(),null!==t.chartInstance&&t.chartInstance.shutdown(),t.chartData[0].data=getChartData(t.data.chart_data.likes,t.$chart,t,t.frequency),t.chartData[1].data=getChartData(t.data.chart_data.reach,t.$chart,t,t.frequency),t.chartInstance=t.$chart.plot(t.chartData,t.chartOptions).data("plot"),t.$dataPointsContainer.show(),$("#skystats-facebook-total-likes-total").html(t.data.total_likes),$("#skystats-facebook-total-likes-change").html(t.data.total_likes_change);var a=$("#skystats-facebook-total-likes-change-info");t.changeTooltipContent(a,t.data.previous_total_likes+" "+a.attr("data-tooltip-backup")),setDataPointChangeDirectionClass("skystats-facebook-total-likes-change-direction",t.data.total_likes_change_direction),setDataPointChangeClass("skystats-facebook-total-likes-change",t.data.total_likes_change_direction),$("#skystats-facebook-total-reach-total").html(t.data.total_reach),$("#skystats-facebook-total-reach-change").html(t.data.total_reach_change);var e=$("#skystats-facebook-total-reach-change-info");t.changeTooltipContent(e,t.data.previous_total_reach+" "+e.attr("data-tooltip-backup")),setDataPointChangeDirectionClass("skystats-facebook-total-reach-change-direction",t.data.total_reach_change_direction),setDataPointChangeClass("skystats-facebook-total-reach-change",t.data.total_reach_change_direction),$("#skystats-facebook-page-visits-total").html(t.data.page_views),$("#skystats-facebook-page-visits-change").html(t.data.page_views_change);var s=$("#skystats-facebook-page-visits-change-info");t.changeTooltipContent(s,t.data.previous_page_views+" "+s.attr("data-tooltip-backup")),setDataPointChangeDirectionClass("skystats-facebook-page-visits-change-direction",t.data.page_views_change_direction),setDataPointChangeClass("skystats-facebook-page-visits-change",t.data.page_views_change_direction),$("#skystats-facebook-people-engaged-total").html(t.data.people_engaged),$("#skystats-facebook-people-engaged-change").html(t.data.people_engaged_change);var i=$("#skystats-facebook-people-engaged-change-info");if(t.changeTooltipContent(i,t.data.previous_people_engaged+" "+i.attr("data-tooltip-backup")),setDataPointChangeDirectionClass("skystats-facebook-people-engaged-change-direction",t.data.people_engaged_change_direction),setDataPointChangeClass("skystats-facebook-people-engaged-change",t.data.people_engaged_change_direction),"detail"===t.viewName&&null!=t.topPostsData){var o=$("#skystats-facebook-top-posts-data-table-tbody"),n="";o.html(""),$.each(t.topPostsData,function(t,a){n+="<tr>"+"<td>"+a.name+"</td>"+"<td>"+a.likes+"</td>"+"<td>"+a.reach+"</td>"+"<td>"+a.comments+"</td>"+"<td>"+a.date+"</td>"+"</tr>"}),$(n).appendTo(o),$("#skystats-facebook-top-posts-data-table-column-content").fadeIn()}t.enableGridIcon(),t.enableSettingsIcon(),t.loadingDataTabData=!1,t.viewingDataTab=!0})},Facebook.prototype.loadSettingsTabData=function(t){this.hideChartFigure();var a=this,e="mashboard"===this.viewName?this.$dataPointsContainer.add(this.$chartContainer):this.$dataPointsContainer.add(this.$chartContainer).add(this.$dataTableColumnsContent);e.fadeOut(400).promise().done(function(){a.$loadingContainer.fadeIn(400,function(){$.get(ajaxurl,{action:"skystats_ajax_facebook_get_page_list",request_type:t},function(t){t=$.parseJSON(t),a.displaySettingsTabData(t)})})})},Facebook.prototype.displaySettingsTabData=function(t){var a=this;a.$loadingContainer.fadeOut(400,function(){if("success"===t.responseType){var e="",s=$("#skystats-facebook-page-list");$.each(t.data,function(t,s){var i=a.selectedPageID===s.id?'selected="selected"':"";e+='<option value="'+s.id+'" '+i+">"+s.name+"</option>"}),s.html(e),a.$settingsTabPageSelectionSection.fadeIn();var i=$("#skystats-facebook-save-page-id");i.off("click"),i.one("click",function(t){t.preventDefault(),a.disableSettingsIcon();var e=s.val();a.selectedPageID=e,a.$settingsTabSections.fadeOut(400).promise().done(function(){a.$loadingContainer.fadeIn(400,function(){$.post(ajaxurl,{action:"skystats_ajax_facebook_save_page_id",page_id:e},function(){a.data=null,"detail"===a.viewName&&(a.loadedAllData=!1),a.loadDataTabData()})})})}),a.$settingsTabDeauthorizeSection.fadeIn()}else switch(t.responseContext){case"authorization_required":a.$settingsTabAuthorizeSection.fadeIn();break;case"reauthorization_required":a.$settingsTabReauthorizeSection.fadeIn();break;case"no_pages":a.$settingsTabNoPagesSection.fadeIn(),a.$settingsTabDeauthorizeSection.fadeIn();break;default:a.$settingsTabDeauthorizeSection.fadeIn()}if(a.viewingSettingsTab=!0,a.loadingSettingsTabData=!1,null!=a.data&&a.enableSettingsIcon(),a.$settingsTabAuthorizeSection.is(":visible")||a.$settingsTabReauthorizeSection.is(":visible")){var o=$("#skystats-facebook-authorize, #skystats-facebook-reauthorize");o.off("click"),o.on("click",function(){a.$settingsTabSections.fadeOut(400).promise().done(function(){a.$loadingContainer.fadeIn(400,function(){$.post(ajaxurl,{action:"skystats_ajax_facebook_authorize"})})})})}if(a.$settingsTabDeauthorizeSection.is(":visible")){var n=$("#skystats-facebook-deauthorize");n.off("click"),n.on("click",function(){a.$settingsTabSections.fadeOut(400).promise().done(function(){a.$loadingContainer.fadeIn(400,function(){$.post(ajaxurl,{action:"skystats_ajax_facebook_deauthorize"})})})})}})},Facebook.prototype.enableGridIcon=function(){Integration.prototype.enableGridIcon.call(this)},Facebook.prototype.disableGridIcon=function(){Integration.prototype.disableGridIcon.call(this)},Facebook.prototype.enableSettingsIcon=function(){Integration.prototype.enableSettingsIcon.call(this)},Facebook.prototype.disableSettingsIcon=function(){Integration.prototype.disableSettingsIcon.call(this)},Facebook.prototype.updateDataTabData=function(t){Integration.prototype.updateDataTabData.call(this,t)},Facebook.prototype.resizeChart=function(){null!=this.data&&(setGlobalPossibleMarkers(null),this.chartInstance.shutdown(),this.chartData[0].data=getChartData(this.data.chart_data.likes,this.$chart,this,"daily"),this.chartData[1].data=getChartData(this.data.chart_data.reach,this.$chart,this,"daily"),this.chartInstance=this.$chart.plot(this.chartData,this.chartOptions).data("plot"))};